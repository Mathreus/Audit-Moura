SELECT  
    COD_ESTABELECIMENTO,
    DEPOSITO,
    DATA,
    NUM_NOTA_FISCAL,
    SUM(QTD) AS QUANTIDADE,
    TIPO_OPERACAO,
    CASE    
        WHEN TIPO_OPERACAO = '1.7.001' THEN 'ENTRADA DE BIN (CLIENTE S/FINANCEIRO)'
        WHEN TIPO_OPERACAO = '2.7.001' THEN 'SAÍDA DE BIN (CLIENTE S/FINANCEIRO)'
        ELSE 'VERIFICAR'
    END AS DESC_OPERACAO
FROM    
    VW_AUDIT_RM_GERENCIAMENTO_ESTOQUE
WHERE
    COD_ESTABELECIMENTO = 'R351'
    AND DATA BETWEEN '2025-07-01' AND '2025-12-31'
    AND TIPO_OPERACAO IN ('1.7.001', '2.7.001') -- Tipos de operação com cliente sem financeiro
    AND NUM_NOTA_FISCAL NOT LIKE '%EST%' -- Retira os estornos
GROUP BY
    COD_ESTABELECIMENTO,
    DEPOSITO,
    DATA,
    NUM_NOTA_FISCAL,
    TIPO_OPERACAO,
    DESC_TIPO_OPERACAO
ORDER BY
    DATA DESC,
    NUM_NOTA_FISCAL;
